<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" href="Logocc.png" type="image/png" />
  <title>Fees Details</title>
  <style>
    :root {
      --bg: #35213f;
      --card-bg: #574a75;
      --header-bg: #40315d;
      --input-bg: #dbe5ec;
      --accent: #8ac6d0;
      --highlight: #b8f3ff;
      --text: #ffffff;
    }

    .light-mode {
      --bg: #f4f4f4;
      --card-bg: #ffffff;
      --header-bg: #374785;
      --input-bg: #dbe5ec;
      --accent: #374785;
      --highlight: #333;
      --text: #000000;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Outfit", sans-serif;
      background-color: var(--bg);
      color: var(--text);
      transition: background 0.3s ease, color 0.3s ease;
    }

    h1 {
      text-align: center;
      margin-top: 30px;
      font-size: 2rem;
      color: var(--text);
    }

    #summary {
      max-width: 950px;
      margin: 10px auto 0;
      padding: 15px;
      background-color: var(--header-bg);
      border-radius: 12px;
      text-align: center;
      font-weight: bold;
      font-size: 1rem;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      color: var(--text);
    }

    .container {
      max-width: 950px;
      margin: 20px auto;
      padding: 20px;
      background-color: var(--card-bg);
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    .top-bar select,
    .top-bar input,
    .top-bar button {
      padding: 10px;
      border-radius: 10px;
      border: none;
      outline: none;
      font-weight: bold;
      font-family: "Outfit", sans-serif;
      background-color: var(--input-bg);
      color: var(--text);
      transition: background 0.3s ease, color 0.3s ease;
    }

    .top-bar button {
      background-color: var(--accent);
      cursor: pointer;
      color: var(--bg);
      transition: background-color 0.3s ease;
    }

    .top-bar button:hover {
      background-color: var(--highlight);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      text-align: center;
      color: var(--text);
    }

    th,
    td {
      padding: 14px 12px;
      border-bottom: 1px solid var(--highlight);
    }

    th {
      background-color: var(--header-bg);
    }

    tr:hover {
      background-color: #665b89;
    }

    .remove-btn,
    .pay-btn {
      padding: 6px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      color: white;
    }

    .remove-btn {
      background-color: #e74c3c;
    }

    .pay-btn {
      background-color: #27ae60;
    }

    .remove-btn:hover {
      background-color: #ff6b5c;
    }

    .pay-btn:hover {
      background-color: #2ecc71;
    }

    .back-btn-container {
      display: flex;
      justify-content: center;
      margin: 30px 0;
    }

    .back-btn {
      padding: 12px 25px;
      background-color: var(--accent);
      color: var(--bg);
      font-weight: bold;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .back-btn:hover {
      background-color: var(--highlight);
      color: var(--text);
    }

    /* Theme Toggle Button */
    .theme-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--card-bg);
      border: 2px solid var(--highlight);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1000;
    }

    .theme-toggle img {
      width: 30px;
      height: 30px;
    }

    .tooltip {
      position: absolute;
      right: 60px;
      background: var(--card-bg);
      color: var(--text);
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 0.85rem;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: 0.3s ease;
      border: 1px solid var(--highlight);
      top: 50%;
      transform: translateY(-50%);
    }

    .theme-toggle:hover .tooltip {
      opacity: 1;
      visibility: visible;
    }
  </style>
</head>
<body>
  <h1>Fees Details</h1>

  <div id="summary"></div>

  <div class="container">
    <div class="top-bar">
      <input
        type="text"
        id="searchInput"
        placeholder="Search by name or roll no..."
        oninput="renderStudents()"
      />
      <select id="statusFilter" onchange="renderStudents()">
        <option value="all">All</option>
        <option value="pending">Pending</option>
        <option value="paid">Paid</option>
      </select>
      <button onclick="exportToCSV()">Export CSV</button>
    </div>
    <table id="studentTable">
      <thead>
        <tr>
          <th>Student Name</th>
          <th>Roll No.</th>
          <th>Department</th>
          <th>Room No.</th>
          <th>Mobile No.</th>
          <th>Payment Status</th>
          <th>Pending Amount</th>
          <th>Pay</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody id="studentBody"></tbody>
    </table>
  </div>

  <div class="back-btn-container">
    <button class="back-btn" onclick="history.back()">⬅ Back to Dashboard</button>
  </div>

  <!-- Theme Toggle -->
  <div class="theme-toggle" onclick="toggleTheme()">
    <div class="tooltip" id="themeTooltip">Switch to light mode</div>
    <img id="themeIcon" src="sunny_979585.png" alt="theme icon" />
  </div>

  <script>
    let students = JSON.parse(localStorage.getItem("students")) || [
      {
        name: "Riya Mehta",
        roll: "101",
        dept: "IT",
        room: "A-001",
        mobile: "9876543210",
        paid: false,
        amountPaid: 0,
        dueAmount: 1000,
      },
      {
        name: "Karan Patel",
        roll: "102",
        dept: "CSE",
        room: "B-021",
        mobile: "9988776655",
        paid: false,
        amountPaid: 0,
        dueAmount: 1000,
      },
      {
        name: "Nisha Singh",
        roll: "103",
        dept: "ECE",
        room: "C-035",
        mobile: "9123456789",
        paid: false,
        amountPaid: 0,
        dueAmount: 1000,
      },
    ];

    function renderStudents() {
      const tbody = document.getElementById("studentBody");
      const search = document.getElementById("searchInput").value.trim().toLowerCase();
      const filterStatus = document.getElementById("statusFilter").value;
      tbody.innerHTML = "";

      const summaryDiv = document.getElementById("summary");
      let totalStudents = students.length;
      let totalPaid = 0;
      let totalDue = 0;
      let paidCount = 0;

      students.forEach((student) => {
        student.dueAmount = isNaN(student.dueAmount) ? 1000 : student.dueAmount;
        student.amountPaid = isNaN(student.amountPaid) ? 0 : student.amountPaid;

        totalPaid += student.amountPaid;
        totalDue += student.dueAmount;
        if (student.paid) paidCount++;
      });

      const pendingCount = totalStudents - paidCount;
      const remainingAmount = totalDue - totalPaid;

      summaryDiv.innerHTML = `
        Total Students: ${totalStudents} |
        Paid: ${paidCount} |
        Pending: ${pendingCount} |
        Total Due: ₹${totalDue} |
        Total Paid: ₹${totalPaid} |
        Remaining: ₹${remainingAmount}
      `;

      students.forEach((student, index) => {
        const matchSearch =
          student.name.toLowerCase().includes(search) ||
          student.roll.toLowerCase().includes(search);
        const matchStatus =
          filterStatus === "all" ||
          (filterStatus === "pending" && !student.paid) ||
          (filterStatus === "paid" && student.paid);

        if (matchSearch && matchStatus) {
          const pendingAmount = student.dueAmount - student.amountPaid;
          const statusText = student.paid
            ? "Paid"
            : `Pending (₹${pendingAmount})`;

          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${student.name}</td>
            <td>${student.roll}</td>
            <td>${student.dept}</td>
            <td>${student.room}</td>
            <td>${student.mobile || "N/A"}</td>
            <td>${statusText}</td>
            <td>₹${pendingAmount}</td>
            <td><button class="pay-btn" onclick="payNow(${index})">Pay</button></td>
            <td><button class="remove-btn" onclick="removeStudent(${index})">Remove</button></td>
          `;
          tbody.appendChild(row);
        }
      });
    }

    function payNow(index) {
      const student = students[index];
      student.dueAmount = isNaN(student.dueAmount) ? 1000 : student.dueAmount;
      student.amountPaid = isNaN(student.amountPaid) ? 0 : student.amountPaid;

      const amountRemaining = student.dueAmount - student.amountPaid;

      const entered = prompt(
        `How much you want to pay for ${student.name}? (Max ₹${amountRemaining})`,
        amountRemaining
      );
      const payAmount = parseInt(entered);

      if (isNaN(payAmount) || payAmount <= 0 || payAmount > amountRemaining) {
        alert("❌ Invalid payment amount.");
        return;
      }

      student.amountPaid += payAmount;
      if (student.amountPaid >= student.dueAmount) {
        student.paid = true;
      }

      localStorage.setItem("students", JSON.stringify(students));
      renderStudents();
      alert(`✅ ₹${payAmount} payment added for ${student.name}`);
    }

    function removeStudent(index) {
      if (confirm("Are you sure you want to remove this student?")) {
        students.splice(index, 1);
        localStorage.setItem("students", JSON.stringify(students));
        renderStudents();
      }
    }

    function exportToCSV() {
      let csv = "Name,Roll,Department,Room,Mobile,Payment Status,Pending Amount\n";
      students.forEach((s) => {
        const status = s.paid
          ? "Paid"
          : `Pending (₹${s.dueAmount - s.amountPaid})`;
        const pending = s.dueAmount - s.amountPaid;
        csv += `${s.name},${s.roll},${s.dept},${s.room},${s.mobile || "N/A"},${status},₹${pending}\n`;
      });
      const blob = new Blob([csv], { type: "text/csv" });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.setAttribute("hidden", "");
      a.setAttribute("href", url);
      a.setAttribute("download", "students.csv");
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    // Theme toggle code
    const body = document.body;
    const themeIcon = document.getElementById("themeIcon");
    const themeTooltip = document.getElementById("themeTooltip");

    function setTheme(theme) {
      if (theme === "light") {
        body.classList.add("light-mode");
        themeIcon.src = "half-moon_547433.png"; // moon icon for light mode (switch to dark)
        themeTooltip.textContent = "Switch to dark mode";
        localStorage.setItem("theme", "light");
      } else {
        body.classList.remove("light-mode");
        themeIcon.src = "sunny_979585.png"; // sun icon for dark mode (switch to light)
        themeTooltip.textContent = "Switch to light mode";
        localStorage.setItem("theme", "dark");
      }
    }

    function toggleTheme() {
      if (body.classList.contains("light-mode")) {
        setTheme("dark");
      } else {
        setTheme("light");
      }
    }

    // On page load, check localStorage for theme
    window.onload = () => {
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme === "light") {
        setTheme("light");
      } else {
        setTheme("dark");
      }
      renderStudents();
    };
  </script>
</body>
</html>
